---
title: "Assignment 05"
subtitle: "REGRESSION ASSUMPTIONS"
author: "Answer Key"
date: "`r Sys.Date()`"
description: "This assignment is worth 15 points. Each question is worth 1 point unless otherwise noted."
format:
  html:
    theme: yeti
    mainfont: 'Raleway'
    code-copy: true
    code-fold: true
    highlight-style: zenburn
    df-print: paged
    toc: true
editor: source
---


```{=html}
<style type="text/css">
caption, .table-caption {
  text-align: left;
}
</style>
```

```{r}
#| label: setup
#| message: false
source("../assets/notes-setup.R")

# Load libraries
library(tidyverse)
library(broom)
library(educate)
library(patchwork)

# Import data
fert = read_csv(file = "https://raw.githubusercontent.com/zief0002/rustic-penguin/main/data/fertility.csv")
evals = read_csv(file = "https://raw.githubusercontent.com/zief0002/rustic-penguin/main/data/evaluations.csv")

# Fit model
lm.1 = lm(avg_eval ~ 1 + beauty, data = evals)
lm.2 = lm(fertility_rate ~ 1 + educ_female + infant_mortality + contraceptive, data = fert)


# Augment model
out.1 = augment(lm.1)
out.2 = augment(lm.2)
```


# Part I: Evaluating Assumptions for the Simple Regression Model


**1. Create the density plot for the outcome. Does the distribution foreshadow problems for the normality assumption? Explain.**

```{r}
#| label: fig-question-01
#| fig-cap: "Marginal distribution of the average course evaluation scores."
ggplot(data = evals, aes(x = avg_eval)) +
  stat_density(geom = "line") +
  theme_bw()  +
  xlab("Average evaluation score") +
  ylab("Probability density")
```


The distribution shows some deviation from normality (left skew). This might produce problems in the regression model, but, to be sure, we will have to see how the residuals behave.

<br />

**2. Create the scatterplot of the outcome vs. the predictor. Include the loess smoother in the plot. Does this relationship foreshadow problems for the linearity assumption? Explain.**

```{r}
#| label: fig-question-02
#| fig-cap: "Scatterplot displaying the relationship between average course evaluation score and professors' rating of beauty. The loess smoother (blue) is also displayed on the plot."
ggplot(data = evals, aes(x = beauty, y = avg_eval)) +
  geom_point(size = 3) +
  theme_bw() +
  xlab("Beauty") +
  ylab("Average evaluation rating") +
  geom_smooth(se = FALSE)
```

The loess smoother suggests some non-linearity, however that deviation is likely just sampling error.

<br />

**3. Create the density plot of the marginal distribution of the standardized residuals from the fitted model. Add the confidence envelope for the normal distribution. Does this plot suggest problems about meeting the normality assumption? Explain.**


```{r}
#| label: fig-question-03
#| fig-cap: "Density plot of the standardized residuals. A confidence envelope assuming the distribution is normally distributed is also included."
ggplot(data = out.1, aes(x = .std.resid)) +
  stat_density_confidence(model = "normal") +
  stat_density(geom = "line") +
  theme_bw()  +
  xlab("Standardized residuals") +
  ylab("Probability density")
```

The plot suggests that the residuals deviate from normality. This deviation, however, is mild and if the remaining assumptions are tenable shouldn't be a huge problem.

<br />

**4. Create the scatterplot of the standardized residuals versus the fitted values from the fitted model. Include any smoothers and confidence envelopes that will allow you to evaluate the linearity assumption. In the plot identify observation with extreme residuals ($\leq-3$ or $\geq3$) by indicating  the row number of that observation in the plot.**

```{r}
#| label: fig-question-04
#| fig-cap: "Scatterplot of the standardized residuals versus the fitted values. The line $y=0$ and the confidence envelope showing the expected uncertainty from that line are also displayed on the plot, along with a loess smoother. Observations with a standardized residual more than three standard errors from 0 are also identified by their row number in the data."
ggplot(data = out.1, aes(x = .fitted, y = .std.resid)) +
  geom_point(size = 3) +
  geom_smooth(method = "lm", se = TRUE) +
  geom_smooth(method = "loess", se = FALSE) +
  theme_bw() +
  xlab("Fitted values") +
  ylab("Standardized residuals") +
  annotate("text", x = 3.96, y = -3.63, label = "30", size = 7)
```

<br />

**5. Does this plot suggest problems about meeting the linearity assumption? Explain.**


The plot does not suggest any problems with linearity. The standardized residuals are evenly dispersed around the line $y=0$. Furthermore the loess smoother is nearly completely encompassed in the confidence envelope, indicating that any deviation from linearity is a result of sampling error. The only place it deviates from this is at fitted values below 3.75, which is the result of a single observation.

<br />

**6. Does this plot suggest problems about meeting the homogeneity of variance assumption? Explain.**

No, the distribution of residuals at each fitted value has roughly the same range. This indicates that the homoscedasticity assumption is tenable.

<br />

**7. Is the independence assumption tenable? Explain.**

Maybe. Knowing one professor's average course evaluation score probably doesn't give you information about another professor's evaluation score. However, an argument could be made for non-independence as well. For example, professors within the same department may influence the teaching of others in their department (or co-teach) which would make the evaluation scores dependent.

<br />


# Part II: Evaluating Assumptions for the Multiple Regression Model

**8. Create the density plot for the outcome. Does the distribution foreshadow problems for the normality assumption? Explain.**

```{r}
#| label: fig-question-08
#| fig-cap: "Density plot of the distribution of fertility rates."
ggplot(data = fert, aes(x = fertility_rate)) +
  stat_density(geom = "line") +
  theme_bw()  +
  xlab("Fertility rate") +
  ylab("Probability density")
```

The marginal distribution foreshadows some potential problems with the normality assumption. Not only is the distribution heavily right-skewed, but it also shows potential bimodality.

<br />

**9. Create the scatterplot of the outcome vs. each predictor (three total). Include the loess smoother in each of the plots. Do any of these relationships foreshadow problems for the linearity assumption? Explain. (2pts.)**

```{r}
#| label: fig-question-09
#| fig-cap: "Scatterplot displaying the relationship between average course evaluation score and each of the three predictors. The loess smoother (blue) is also displayed on each plot."
#| fig-width: 12
#| fig-height: 4
#| out-width: "90%"
p1 = ggplot(data = fert, aes(x = contraceptive, y = fertility_rate)) +
  geom_point() +
  theme_bw() +
  xlab("Contraceptive use") +
  ylab("Fertility rate") +
  geom_smooth(se = FALSE) +
  ggtitle("Contraceptive Use")

p2 = ggplot(data = fert, aes(x = educ_female, y = fertility_rate)) +
  geom_point() +
  theme_bw() +
  xlab("Female education (in years)") +
  ylab("Fertility rate") +
  geom_smooth(se = FALSE) +
  ggtitle("Female Education")

p3 = ggplot(data = fert, aes(x = infant_mortality, y = fertility_rate)) +
  geom_point() +
  theme_bw() +
  xlab("Infant mortality rate") +
  ylab("Fertility rate") +
  geom_smooth(se = FALSE) +
  ggtitle("Infant Mortality Rate")

# Layout plots
p1 | p2 | p3
```

The loess smoother suggests that the relationship between female education and fertility rate and between infant mortality rate and fertility rate are potentially non-linear. This may foreshadow problems with the linearity assumption. (The other two plots do not foreshadow issus with the linearity assumption.)

<br />

**10. Create the density plot of the marginal distribution of the standardized residuals from the fitted model. Add the confidence envelope for the normal distribution. Does this plot suggest problems about meeting the normality assumption? Explain.**


```{r}
#| label: fig-question-10
#| fig-cap: "Density plot of the standardized residuals. A confidence envelope assuming the distribution is normally distributed is also included."
ggplot(data = out.2, aes(x = .std.resid)) +
  stat_density_confidence(model = "normal") +
  stat_density(geom = "line") +
  theme_bw()  +
  xlab("Standardized residuals") +
  ylab("Probability density")
```

The residuals show no deviation from normality as the density is completely encompassed in the confidence envelope. This indicates any sample deviation from normality may be due to sampling error. 

<br />


**11. Create the scatterplot of the standardized residuals versus the fitted values from the fitted model. Include any smoothers or confidence envelopes that will allow you to evaluate the linearity assumption. In the plot identify observation with extreme residuals ($\leq-3$ or $\geq3$) by indicating the country associated with that observation in the plot.**

```{r}
#| label: fig-question-11
#| fig-cap: "Scatterplot of the standardized residuals versus the fitted values. The line $y=0$ and the confidence envelope showing the expected uncertainty from that line are also displayed on the plot, along with a loess smoother. Observations with a standardized residual more than three standard errors from 0 are also identified by their country name."
extreme = out.2 |>
  mutate(country = fert$country) |>
  filter(abs(.std.resid) > 3)

ggplot(data = out.2, aes(x = .fitted, y = .std.resid)) +
  geom_point(size = 3) +
  geom_smooth(method = "lm", se = TRUE) +
  geom_smooth(method = "loess", se = FALSE) +
  theme_bw() +
  xlab("Fitted values") +
  ylab("Standardized residuals") +
  annotate("text", x = 3.86, y = 3.15, label = "Uganda", hjust = 0, size = 6)
```

<br />

**12. Does this plot suggest problems about meeting the linearity assumption? Explain.**

Yes. The loess smoother deviates from the confidence envelope at several places. This indicates that the linearity assumption may not be tenable.

<br />

**13. Does this plot suggest problems about meeting the homogeneity of variance assumption? Explain.**

Yes. The plot shows fanning in which the variation in the standardized residuals gets larger at larger fitted values.

<br />

**14. Is the independence assumption tenable? Explain.**

Probably. There is no cluster, spatial or longitudinal sampling that has taken place. It is also unlikely that the fertility rate in one country has much relationship with the fertility rate in any other country.

<br />

