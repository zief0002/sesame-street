---
title: "Assignment 04"
subtitle: "INTRODUCTION TO MULTIPLE REGRESSION"
author: "Answer Key"
date: "`r Sys.Date()`"
description: "This assignment is worth 16 points. Each question is worth 1 point unless otherwise noted."
format:
  html:
    theme: yeti
    mainfont: 'Raleway'
    code-copy: true
    code-fold: true
    highlight-style: zenburn
    df-print: paged
    toc: true
editor: source
---


```{=html}
<style type="text/css">
caption, .table-caption {
  text-align: left;
}
</style>
```

```{r}
#| label: setup
#| message: false
source("../assets/notes-setup.R")

# Load libraries
library(tidyverse)
library(broom)
library(corrr)

# Import data
fertility = read_csv(file = "https://raw.githubusercontent.com/zief0002/rustic-penguin/main/data/fertility.csv")

# Fit models
lm.1 = lm(fertility_rate ~ 1 + contraceptive,                                  data = fertility)
lm.2 = lm(fertility_rate ~ 1 + contraceptive + infant_mortality,               data = fertility)
lm.3 = lm(fertility_rate ~ 1 + contraceptive + infant_mortality + educ_female, data = fertility)
```



<br />


## Part I: Correlations

**1. Examine the structure and formatting of Table 4 at <https://zief0002.github.io/musings/creating-tables-to-present-statistical-results.html#creating-tables-to-present-statistical-results>. Mimic the format and structure of this table to create a table to present the pairwise correlations between the outcome and each of the predictors, and between each set of predictors. Make sure the table you create also has an appropriate caption. (2pts.)**

```{r}
#| label: tbl-question-01
#| tbl-cap: "Intercorrelations between four country-level measures related to human overpopulation."
fertility |>
  dplyr::select(fertility_rate, contraceptive, infant_mortality, educ_female) |>
  correlate() |>
  shave(upper = TRUE) |>
  fashion(decimals = 3, na_print = "â€”") |>
  data.frame() |>
  mutate(
    term = c("1. Fertility rate", "2. Contraceptive rate", "3. Infant mortality rate", "4. Female education level")
  ) |>
  gt() |>
  cols_label(
    term = "Measure",
    fertility_rate = "1",
    contraceptive = "2",
    infant_mortality = "3",
    educ_female = "4"
  ) |>
  cols_align(
    columns = c(term),
    align = "left"
  ) |>
  cols_align(
    columns = c(fertility_rate, contraceptive, infant_mortality, educ_female),
    align = "center"
  ) |>
  tab_options(
    table.width = pct(80),
    table.align = "left"
  )
```

<br />


**2. Use the results from the intercorrelations to evaluate each of the following hypotheses. Explain by referencing your results. (3pts.)**

Hypothesis 1 is supported by the empirical data as the correlation coefficient between contraception rate and fertility rate is negative ($r=-.695$). That is, countries with higher contraception rates tend to have lower fertility rates.

Hypothesis 2 is supported by the empirical data as the correlation coefficient between infant mortality rate and
contraception rate is negative ($r=.-.703$). That is, countries with higher infant mortality rates tend to have lower contraception rates.

Hypothesis 3 is supported by the empirical data as the correlation coefficient between female education level and
contraception rate is positive ($r=.604$). That is, countries with higher levels of female education also tend to have higher contraception rates.

<br />


## Part II: Regression Analysis


**3. Examine the structure and formatting of Table 9 at <http://zief0002.github.io/epsy-8251/misc/creating-tables/creating-tables.html>. Mimic the format and structure of this table to create a table to present the numerical information from the three models you fitted in this assignment. Make sure the table you create also has an appropriate caption. If the table is too wide, change the page orientation in your word processing program to "Landscape", rather than changing the size of the font. (2pts.)**

```{r}
#| echo: false
#| results: asis
#| eval: false
library(stargazer)
stargazer(lm.1, lm.2, lm.3,
  type = "html",        
  ci = TRUE,
  column.labels = c("Model 1", "Model 2", "Model 3"),
  covariate.labels = c("Contraceptive rate", "Infant mortality rate", "Female education level"),
  dep.var.caption = "Outcome variable: Fertility rate",
  dep.var.labels = NULL,
  dep.var.labels.include = FALSE,
  keep.stat = c("rsq","ser"),
  star.cutoffs = NA,
  header = FALSE,
  title = "Table 2<br/>Coefficients and 95% confidence intervals for a series of regression models fitted to data from <i>n</i>=124 countries to predict variation in fertility rates.",
  omit.table.layout = "n"
  )

```

<table style="text-align:center; width:80%;">
<caption>
  Table 2<br/>Coefficients and 95% confidence intervals for a series of regression models fitted to data from <i>n</i>=124 countries to predict variation in fertility rates.
</caption>
<tr>
  <td colspan="4" style="border-bottom: 1px solid black"></td>
</tr>
<tr>
  <td style="text-align:left">Measure</td>
  <td>Model 1</td>
  <td>Model 2</td>
  <td>Model 3</td>
</tr>
<tr>
  <td colspan="4" style="border-bottom: 1px solid black"></td>
</tr>
<tr>
  <td style="text-align:left">Contraceptive rate</td>
  <td>-0.05</td>
  <td>-0.02</td>
  <td>-0.02</td>
</tr>
<tr>
  <td style="text-align:left"></td>
  <td>(-0.06, -0.04)</td>
  <td>(-0.03, -0.01)</td>
  <td>(-0.02, -0.01)</td>
</tr>
<tr>
  <td style="text-align:left"></td>
  <td></td><td></td>
  <td></td>
</tr>
<tr>
  <td style="text-align:left">Infant mortality rate</td>
  <td></td>
  <td>0.04</td>
  <td>0.02</td>
</tr>
<tr>
  <td style="text-align:left"></td>
  <td></td>
  <td>(0.03, 0.05)</td>
  <td>(0.02, 0.03)</td>
</tr>
<tr>
  <td style="text-align:left"></td>
  <td></td>
  <td></td>
  <td></td>
</tr>
<tr>
  <td style="text-align:left">Female education level</td>
  <td></td>
  <td></td>
  <td>-0.13</td>
</tr>
<tr>
  <td style="text-align:left"></td>
  <td></td>
  <td></td>
  <td>(-0.19, -0.07)</td>
</tr>
<tr>
  <td style="text-align:left"></td>
  <td></td>
  <td></td>
  <td></td>
</tr>
<tr>
  <td style="text-align:left">Constant</td>
  <td>5.52</td>
  <td>2.71</td>
  <td>3.88</td>
</tr>
<tr>
  <td style="text-align:left"></td>
  <td>(4.97, 6.06)</td>
  <td>(1.98, 3.45)</td>
  <td>(3.00, 4.75)</td>
</tr>
<tr>
  <td style="text-align:left"></td>
  <td></td>
  <td></td>
  <td></td>
</tr>
<tr>
  <td colspan="4" style="border-bottom: 1px solid black"></td>
</tr>
<tr>
  <td style="text-align:left">R<sup>2</sup></td>
  <td>0.484</td>
  <td>0.694</td>
  <td>0.734</td>
</tr>
<tr>
  <td style="text-align:left">Residual Std. Error</td>
  <td>1.00</td>
  <td>0.77</td>
  <td>0.72</td>
</tr>
<tr>
  <td colspan="4" style="border-bottom: 1px solid black"></td>
</tr>
</table>


<br />

**4. Based on the results of fitting the three models, describe the size and direction of the effect of contraceptive rate on fertility rate and how it changes (or doesn't) across the three models. Do this by referring to the estimated coefficient and the uncertainty in the parameter estimates. *Note:* Do not base your response on a *p*-value. (2pts.)**


In all three models the effect of contraceptive rate on fertility rate is negative, even after accounting for any sampling uncertainty (i.e., the CIs for all three models span negative ranges). The size of the effect is fairly small. In Model 1, each 1 percentage point difference in contraceptive rate is associated with between a .04 and .06 percentage point reduction in fertility rate. This effect gets weaker after we control for infant mortality rate in Model 2, and even weaker after controlling for both infant mortality rate and female education level in Model 3. 


<br />



## Model 3: Interpreting Results from the "Final" Model

**5. Report the regression equation from fitting Model 3. Use Equation Editor (or some other program that correctly types mathematical expressions) to typeset the equation correctly.**

$$
\hat{\mathrm{Fertility~Rate}}_i = 3.87 - 0.01(\mathrm{Contraceptive~Rate}_i) + 0.02(\mathrm{Infant~Mortality~Rate}_i) - 0.13(\mathrm{Female~Education~Level}_i)
$$

<br />

**6. Using output from the ANOVA table, compute and report the value for the model $R^2$. Show your work for full credit.**

```{r}
#| results: hide
anova(lm.3)
```



$$
\begin{split}
R^2 &= \frac{114.232 + 49.812 + 9.341}{114.232 + 49.812 + 9.341 + 62.868} \\[2ex] 
&= \frac{173.385}{236.253} \\[2ex] 
&= 0.734
\end{split}
$$

<br />

**7. Interpret the value of the model $R^2$ using the context of the data.**

Differences in countries' contraceptive rates, infant mortality rates, and female education levels explain 73.4% of the variation in fertility rates.

<br />

**8. Using symbols, write the omnibus null hypothesis that is tested by the *F*-statistic in this analysis in two different manners: (1) using the coefficient parameters used in the regression model, and (2) using the variance accounted for parameter.**

$$
\begin{split}
&(1) \qquad H_0: \beta_{\mathrm{Contraceptive~Rate}} = \beta_{\mathrm{Infant~Mortality~Rate}} = \beta_{\mathrm{Female~Education~Level}} = 0\\
&(2) \qquad H_0: \rho^2 = 0
\end{split}
$$

<br />

**9. Based on the results of the *F*-test, does the model seem to explain variation in fertility rates? Explain. Note: Here you can use the *p*-value as evidence, but do not compare this to 0.05.**

Yes, the model seems to explain variation in fertility rates, $F(3, 120)=110.3, p<.001$. The incredibly small *p*-value suggests that the empirical data are incredibly unlikely given the null hypothesis of no explained variation. This suggests that the model does explain variation in fertility rates

<br />

**10. Interpret the estimated coefficient value associated with the partial effect of contraception.**

Each one percentage point difference in contraceptive rates is associated with a $-0.01$ percentage point difference in fertility rates, on average, controlling for differences in infant mortality rates and female education levels.

<br />

**11. Based on the 95% confidence interval for the partial effect of contraception on fertility rate, which parameter values are reasonably compatible with the empirical data? Explain what this implies about the magnitude of the partial effect.**

The 95% CI for the partial effect of contraception on fertility rate is $[-0.02,-0.01]$. This suggests that after controlling for differences in infant mortality rates and female education levels, a one percentage point difference in contraceptive rates may be associated with something as low as a $-0.01$ percentage point difference in fertility rate or as high as a $-0.02$ percentage point difference. While we are pretty sure the effect is negative, the uncertainty makes it unclear how large this partial effect really is.


<br />

**12. Create a publication quality plot that displays the results from Model 3. For this plot, put the contraception predictor on the *x*-axis. Control out the effect of education level by setting this to the mean level of education. Display two separate lines to show the effect of infant mortality rate; a small and large rate based on the data. The two lines should be displayed using different linetypes or colors (or both) so that they can be easily differentiated in the plot. Be sure that the figure is appropriately captioned. (2pts.)**

```{r}
#| label: fig-question-12
#| fig-cap: "Model predicted fertility rates as a function of contraceptive rate for countries with infant mortality rates at the 25th (low; solid blue line) and 75th (high; dashed orange line) percentiles. Female education level was controlled out of the model by setting this value to its mean."
ggplot(data = fertility, aes(x = contraceptive, y = fertility_rate)) +
  geom_point(alpha = 0) +
  geom_abline(intercept = 3.07188, slope = -0.01486, color = "#56b4e9", linewidth = 1.5) +
  geom_abline(intercept = 3.898701, slope = -0.01486, color = "#e69f00", linewidth = 1.5, linetype = "dashed") +
  theme_bw() +
  xlab("Contraceptive rate") +
  ylab("Predicted fertility rate") +
  theme(
    text = element_text(size = 12)
    )
```


<br />


